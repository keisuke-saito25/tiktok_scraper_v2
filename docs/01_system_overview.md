# TikTok Scraper システム概要

## 1. プロジェクト概要

TikTok Scraperは、TikTokの楽曲ページからUGC（ユーザー生成コンテンツ）データを収集・分析・可視化するための包括的なツールキットです。

### 主な目的
- TikTok楽曲ページからUGC数（その楽曲を使用した動画の数）を自動収集
- 収集したデータの時系列管理と増減分析
- データのビジュアライゼーションとランキング生成

### 対象ユーザー
- 音楽レーベル・アーティストのマーケティング担当者
- TikTokでの楽曲パフォーマンスを追跡したい企業
- データ分析担当者

## 2. システム構成

本システムは3つの主要コンポーネントと運用スクリプトで構成されています。

```
tiktok_scraper/
├── tiktok_toolkit/          # GUIベースのスクレイピングツール
├── tiktok_ugc_scraper/      # CLIベースのスクレイピングツール（並列処理対応）
├── tiktok_ugc_chart/        # Webダッシュボード（可視化・ランキング）
└── scripts/                 # 並列実行用バッチスクリプト
```

### 2.1 tiktok_toolkit（GUIツール）

**用途**: 手動操作でTikTokデータを収集するためのデスクトップアプリケーション

**主な機能**:
- Tkinter GUIによる直感的な操作
- 楽曲URLリストからの動画URL収集（機能1）
- 収集した動画の詳細情報取得（機能2）
- ログイン状態の自動確認
- スクリーンショット保存
- PyInstallerによる実行ファイル生成

**技術スタック**: Python 3.x, Tkinter, Selenium, openpyxl, pandas

### 2.2 tiktok_ugc_scraper（CLIツール）

**用途**: 自動化・並列処理でUGCデータを大量収集するためのコマンドラインツール

**主な機能**:
- 複数の動作モード
  - `process`: 通常のスクレイピング処理
  - `retry`: 失敗した処理の再試行
  - `collect`: 並列収集（複数ワーカー対応）
  - `apply`: 収集結果をExcelに統合
- シャーディング（データ分割）による並列処理
- 堅牢なエラーハンドリングとリトライ機能

**技術スタック**: Python 3.x, Selenium, openpyxl, webdriver-manager

### 2.3 tiktok_ugc_chart（Webダッシュボード）

**用途**: 収集したデータの可視化とランキング生成

**主な機能**:
- UGCデータのチャート表示
- アカウントごとのフォロワー数表示
- ランキング生成（複数タイプ対応）
- 画像エクスポート機能
- Excelファイルのインポート/エクスポート

**技術スタック**: Vue 3, TypeScript, Vuetify 3, Chart.js, Vite

### 2.4 scripts（並列処理スクリプト）

**用途**: 並列スクレイピングの自動実行

**含まれるスクリプト**:
- `run_collect.bat`: 2ワーカーで並列収集を実行
- `run_apply.bat`: 収集結果をExcelに統合
- `stop_collect.bat`: 実行中のプロセスを停止

## 3. データフロー

```
┌─────────────────────────────────────────────────────────────────────┐
│                        入力データ                                    │
│  ・楽曲マスタ（Excel）: 曲名とTikTok楽曲URL                         │
└─────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    スクレイピング処理                                │
│  tiktok_toolkit (GUI) または tiktok_ugc_scraper (CLI)               │
│  ・Seleniumで TikTok楽曲ページにアクセス                            │
│  ・UGC数（動画数）を取得                                            │
│  ・動画URL、投稿日、再生数、いいね数、コメント数を収集              │
└─────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      データ保存                                      │
│  ・UGCシート: 日付ごとのUGC数を記録                                 │
│  ・増減シート: 前日比の増減を記録                                    │
│  ・詳細シート: 各動画の詳細情報                                      │
└─────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      可視化・分析                                    │
│  tiktok_ugc_chart (Web Dashboard)                                    │
│  ・UGC推移チャート                                                   │
│  ・アカウントランキング                                              │
│  ・画像エクスポート                                                  │
└─────────────────────────────────────────────────────────────────────┘
```

## 4. 主要なExcelシート構成

### TikTok_UGC.xlsx（メインデータファイル）

| シート名 | 内容 |
|---------|------|
| 楽曲マスタ | 曲名とTikTok楽曲URLのマスタリスト |
| UGC | 日付ごとのUGC数（列=日付、行=楽曲） |
| 増減 | 前日比のUGC増減数 |
| [日付] | 各日の動画詳細（URL、再生数、いいね数など） |

### initial_settings.xlsx（設定ファイル）

- 処理対象の楽曲URLリストを管理

## 5. 技術的特徴

### アンチボット対策
- User-Agentの設定
- 適切な待機時間の設定
- Chromeプロファイルの分離
- `navigator.webdriver`プロパティの隠蔽

### エラー耐性
- 指数バックオフによるリトライ
- タイムアウト時の自動復旧
- プロセス異常終了時のクリーンアップ

### 並列処理
- シャーディングによるデータ分割
- 複数Chromeプロファイルの同時利用
- CSV経由でのデータ集約

## 6. システム要件

### 共通
- Google Chrome（最新版推奨）
- 安定したインターネット接続

### Python環境
- Python 3.7以上
- 主要パッケージ: selenium, openpyxl, pandas, webdriver-manager

### Node.js環境（tiktok_ugc_chart用）
- Node.js 18以上
- npm 9以上
